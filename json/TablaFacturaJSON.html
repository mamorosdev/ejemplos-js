<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>FACTURA GENERADA A PARTIR DE UN OBJETO JSON</title>
<script type="text/javascript">
// Estructura básica del objeto Factura
var factura = {
	empresa: {
		nombre: "Nombre de la empresa",
		direccion: "Dirección de la empresa",
		telefono: "900900900",
		nif: ""
	},
	cliente: {
		nombre: "Merkadonline",
		direccion: "Dirección del cliente",
		telefono: "600600600",
		nif: "XXXXXXXXX"
	},
	elementos: [
		{ descripcion: "Aceite 2L", cantidad: 1, precio: 4 },
		{ descripcion: "Naranjas 5Kg", cantidad: 2, precio: 3 },
		{ descripcion: "Arroz largo 1Kg", cantidad: 4, precio: 0.5 },
		{ descripcion: "Tomate frito 800g", cantidad: 2, precio: 1 },
		{ descripcion: "Agua 5L", cantidad: 2, precio: 1 },
		{ descripcion: "Vino Extra", cantidad: 4, precio: 6 }
		],
	informacion: {
		baseImponible: 0,
		iva: 7,
		total: 0,
		formaPago: "contado"
	}
};
var cabeceraTablaFactura = ["Producto","Cantidad","Pr.Unidad","Pr.Subtotal"];

// Método para pintar la factura y calcular el total.
factura.calculaTotal = function() {
	
	var tablaResultados = "<table><tr>";
	for(var j=0;j<cabeceraTablaFactura.length; j++) {
		tablaResultados += "<th id='header" + j + "'>"+cabeceraTablaFactura[j]+"</th>";
	}
	tablaResultados += "</tr>";
	for(var i=0; i<this.elementos.length; i++) {
		this.informacion.baseImponible += this.elementos[i].cantidad * this.elementos[i].precio;
		tablaResultados += 
			"<tr><td headers='header1'>" + this.elementos[i].descripcion + 
			"</td><td headers='header2'>" + this.elementos[i].cantidad + 
			"</td><td headers='header3'>" + this.elementos[i].precio + 
			"</td><td headers='header4'>" + 
				(this.elementos[i].cantidad * this.elementos[i].precio) + " euros </td></tr>";
	}
	tablaResultados += "</table><p>Precio base = " + this.informacion.baseImponible + " euros</p>";
	tablaResultados += "<p>IVA aplicado = " + this.informacion.iva + " %</p>";
	document.write(tablaResultados);
	this.informacion.total = this.informacion.baseImponible + this.informacion.baseImponible * this.informacion.iva/100;
}

// Visualización del total.
factura.muestraTotal = function() {
	var resultadoFactura = "<table><tr><h3>PEDIDO "
		+this.cliente.nombre+";"+this.cliente.direccion+"</h3>";
	document.write(resultadoFactura);
	this.calculaTotal();
	resultadoFactura = "<p>TOTAL = " 
		+ this.informacion.total + " euros</p>";
	document.write(resultadoFactura);
}

// Mostrar los datos de la factura cuando se haya cargado toda la página.
window.onload = function() {
	factura.muestraTotal();
}
</script>
</head>
<body>
<h2>FACTURA GENERADA A PARTIR DE UN OBJETO JSON</h2>
</body>
</html>
